<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> -->
    <title>购买历史查询</title>
    <link rel="stylesheet" href="../public/bootstrap.css">
    <style>
        html,
        body,
        .loading-wrap {
            height: 100%;
        }
        
        .loading-wrap {
            background-color: rgba(0, 0, 0, .5);
            align-items: center;
            position: fixed;
            z-index: 999;
            width: 100%;
        }
        
        .wrap {
            height: 100%;
            padding: 0 30px;
        }
        
        .item-wrap {
            margin-right: 10px;
        }
        
        .item-wrap p {
            margin: 0;
            padding: 0;
        }
        
        .label {
            display: inline-block;
            width: 200px;
        }
        
        .number {
            width: 140px;
        }
        
        .token {
            width: 140px;
        }
        
        .text-black-50 {
            font-size: 14px;
        }
        
        .badge-secondary {
            margin-left: 10px;
        }
        
        div.hide {
            display: none !important;
        }
        
        div.show {
            display: flex !important;
        }
        
        .form-group {
            width: 300px;
            padding: 20px 0 0 20px;
        }
        
        .header {
            display: flex;
            /* flex-direction: column; */
            padding-top: 10px;
            flex-wrap: wrap;
        }
        
        .header-item {
            margin-bottom: 10px;
            margin-left: 10px;
        }
    </style>
</head>

<body>
    <div class="d-flex justify-content-center loading-wrap" id="loading">
        <div class="spinner-border" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <div class="header">
        <div class="header-item">
            <select onchange="selId(event)" class="sel-wrap form-control" id="exampleFormControlSelect1">
                <option value="">选择</option>
                <option value="0x6006aabb73454c9cfae62febbc6c3f3728f546c8">鱼化寨一号</option>
                <option value="0x9ba78a93387cdee2769ae6e24d3f13e2ec2b12ef">小明星</option>
                <option value="0x3342572427e79309071b43368cc7976e5c627a12">我想吃西瓜</option>
                <option value="0xeb6124360c548c9593f39b8d889facde76e52fb3">马迪托1号(干杯)</option>
                <option value="0xca7155fb215750619e6d68fc5d2363be77252886">爱学习的小白(干杯)</option>
                <option value="0xcb6e6e58d97bd5bbc5eae37a77171ca88364f458">Lj72cgRf(干杯)</option>
                <option value="0x4018fee7752c503b6c2ad8b5807bfecef5eb9ec7">Dashazi(干杯)</option>
                <option value="0xc2618849b719bce2016c0e27b3925b35a33fa8ff">超超小飞侠NFT(干杯)</option>
                <option value="0xf66dcdbb3110a1d833b32a28da3083d644d639be">麻辣小龙虾</option>
                <option value="0xfe4f8cb9b5861efc496ee07ad0cc74e3363b363e">财神爷</option>
                <option value="0xcd05bf87177b6ed34bd3f67ff04fda79ae5c8076">鱼化寨2号</option>
                <option value="0x2c93bdd79b7930b14f520ca2238e22a2e52a657e">暴富三符(N卡2号)</option>
                <option value="0x5067236b58238325225fbdb276db52f8bbb82f76">重点2</option>
                <option value="0x7cf335280c65554e4ce3f6268b030a5918088e5f">南拳妈妈 干杯</option>
                <option value="0xc447a826ad68265a395953aadf04cbefdbb72015">大闹群主小号</option>
                <option value="0x267a4882ad378ed5a9ce44263cfe1290ed7c85ba">test</option>
                <option value="0xe313acea8d1e6ffb9d6a2824554074b41a31ca9f">公告前买小老虎的</option>
                <option value="0x65652Ce109F1f538252C3ba6bc3E145744A6F955">24k</option>
                <option value="0x0ae867f59df1ed5442d55d8a39d3b8403892dc3a">阿达</option>
                <option value="0x1aac1c9d7209ff82877f1442034a1789d813fdb6">张国荣查出来的</option>
                <option value="0x8a8e090adf437bb30eaf601a5a4d109a08d72d89">41个SR</option>
                <option value="0xe79fa002b78fce232b49ab5e1ef4030dc438b31e">19个SR</option>
                <option value="0x349dc209b8469b5b18f06a4dcf7ef0d7d774759f">19个SR2号</option>
                <option value="0x9f36c056bccac8189c5ee3a1885e512fdbd08072">29个SR</option>
                <option value="0xbaf513549b1b05c93e66cf94c82e805ff3651a46">10个SR</option>

            </select>
        </div>
        <div class="header-item">
            <input class="form-control" oninput="iptChange(event)">
        </div>
        <div class="header-item">
            <button type="button" class="btn btn-primary" onclick="queryResult()">查 询</button>
        </div>
    </div>
    <div class="wrap">
        <ul class="list-group list-group-flush" id="ul_wrap">
            <!-- <li class="list-group-item d-flex">
                <div class="item-wrap">
                    <p>想你的液 <span class="bg-danger badge badge-secondary">卖出</span></p>
                    <div class="text-black-50">
                        <span class="label">时间: <span>2022-05-04 21:59:59</span></span>
                        <span class="label token">tokenId: 12345</span>
                        <span class="label number">编号: 12345</span>
                    </div>
                </div>
            </li>
            <li class="list-group-item d-flex">
                <div class="item-wrap">
                    <p>想你的液想你的液 <span class="bg-success badge badge-secondary">买入</span></p>
                    <div class="text-black-50">
                        <span class="label">时间: <span>2022-05-04 21:59:59</span></span>
                        <span class="label token">tokenId: 12345</span>
                        <span class="label number">编号: 12345</span>
                    </div>
                </div>
            </li> -->
        </ul>
    </div>

    <script src="../public/jquery.js"></script>
    <script src="../public/moment.js"></script>
    <script src="../public/bootstrap.js"></script>
    <script>
        let id = '0xfe4f8cb9b5861efc496ee07ad0cc74e3363b363e'
        let iptAddress = ''
        const loading = document.getElementById('loading')
            // getData()
        $("#loading").addClass("hide");
        $("#loading").removeClass("show");

        function selId(e) {
            console.log('e: ', e.target.value);
            if (e.target.value) {
                getData(e.target.value)
            }
        }
        // http://60.205.252.237:8080/Api/Token/verifyIbox
        // url: "http://60.205.252.237:8080/Api/Token/verifyToken",



        function queryResult() {
            getData(iptAddress)
        }

        function iptChange(e) {
            iptAddress = e.target.value
        }

        function getData(address) {
            let iid;
            if (address) {
                id = address
                iid = address
            } else {
                iid = id
            }
            $("#loading").addClass("show");
            $("#loading").removeClass("hide");
            // 0xd3d20d0bd31751f084cb4e4ff98e568c8c2132fb
            $.ajax({
                // url: `https://api.hecoinfo.com/api?module=account&action=tokennfttx&address=${iid}&page=0&offset=10&sort=desc`,
                url: `https://api.hecoinfo.com/api?module=account&action=tokennfttx&address=${iid}&page=1&offset=200&sort=desc`,
                // url: `https://api.hecoinfo.com/api?module=account&action=tokennfttx&address=${iid}&startblock=0&endblock=999999999&sort=desc`,
                type: "get",
                dataType: 'json',
                success: function(msg) {
                    console.log('msg: ', msg);
                    let tokenids = []
                    for (let i = 0; i < msg.result.length; i++) {
                        const item = msg.result[i];
                        tokenids.push(item.tokenID)
                    }

                    // render(msg, iid)
                    getProductList(tokenids.toString(), (data_ibox) => {
                        render(msg, iid, data_ibox)
                    })
                },
                error: function() {
                    $("#loading").addClass("hide");
                    $("#loading").removeClass("show");
                }
            });
        }

        function render(data, iid, data_ibox) {
            // const ibox = [{}]
            const ibox = data_ibox.data || [{}]
            $("#loading").addClass("hide");
            $("#loading").removeClass("show");

            var a2 = {
                "code": 1,
                "data": {
                    "currPage": 1,
                    "hashNext": 0,
                    "list": [{
                        "id": 198,
                        "noticeName": "iBox 5月9日上新藏品《大闹天宫-十万天兵天将下凡》",
                        "noticeTime": 1651910400000
                    }, {
                        "id": 201,
                        "noticeName": "iBox 5月10号春日限定合成活动再次开启",
                        "noticeTime": 1651930200000
                    }, {
                        "id": 205,
                        "noticeName": "“猛虎潜深山，长啸自生风。”iBox5月11日霸气开启合成目标藏品《赤啸虎》",
                        "noticeTime": 1651986060000
                    }, {
                        "id": 208,
                        "noticeName": "“青出于蓝而胜于蓝”iBox 5月13日上新藏品《出于蓝》",
                        "noticeTime": 1652016000000
                    }, {
                        "id": 210,
                        "noticeName": "“惟有葵花向日倾”iBox 5月14日上新藏品《向阳》",
                        "noticeTime": 1652080620000
                    }, {
                        "id": 163,
                        "noticeName": "iBox全网首创“缤纷好运来”合成活动即将开启",
                        "noticeTime": 1651487040000
                    }, {
                        "id": 161,
                        "noticeName": "iBox八期盲盒《民国六大金曲》即将开启合成公告",
                        "noticeTime": 1651458720000
                    }, {
                        "id": 133,
                        "noticeName": "iBox APP下载及官网访问方式指引",
                        "noticeTime": 1651119900000
                    }, {
                        "id": 118,
                        "noticeName": "iBox关于提升藏品寄售限额的公告",
                        "noticeTime": 1650966000000
                    }, {
                        "id": 211,
                        "noticeName": "iBox将对《神王-宙斯》进行发放限量专属空投公告",
                        "noticeTime": 1652085600000
                    }, {
                        "id": 209,
                        "noticeName": "iBox5月9日优先抢《大闹天宫-十万天兵天将下凡》白名单公示",
                        "noticeTime": 1652077800000
                    }, {
                        "id": 207,
                        "noticeName": "iBox《太平有象》18:00开放寄售公告",
                        "noticeTime": 1652004000000
                    }, {
                        "id": 206,
                        "noticeName": "iBox 5月8日上新藏品《太平有象》优先购白名单公示",
                        "noticeTime": 1651991400000
                    }, {
                        "id": 203,
                        "noticeName": "iBox日常维护反馈",
                        "noticeTime": 1651977780000
                    }, {
                        "id": 200,
                        "noticeName": "关于iBox上线内容审核机制公告",
                        "noticeTime": 1651915800000
                    }, {
                        "id": 197,
                        "noticeName": "iBox 5月7日上新藏品《孔雀呈祥》白名单公示",
                        "noticeTime": 1651905480000
                    }, {
                        "id": 196,
                        "noticeName": "幸运儿空投藏品《sunny！sunny！》11:00开放寄售公告",
                        "noticeTime": 1651892160000
                    }, {
                        "id": 195,
                        "noticeName": "iBox关于发放“五一空投活动”藏品说明",
                        "noticeTime": 1651847760000
                    }, {
                        "id": 194,
                        "noticeName": "“清凉一夏河马到”iBox又来送福利啦！",
                        "noticeTime": 1651843200000
                    }, {
                        "id": 193,
                        "noticeName": "关于iBox调整“锁仓藏品行为”规则公告",
                        "noticeTime": 1651835700000
                    }],
                    "pageSize": 20,
                    "totalCount": 107,
                    "totalPage": 6
                },
                "message": "success",
                "msgId": "0af88ba8b6374f7087e08366cb6fa920",
                "success": true
            }
            let html = ''
            for (let i = 0; i < data.result.length; i++) {
                const item = data.result[i];
                item.noticeTime = item.timeStamp * 1000
            }


            var resultData = data.result.concat(a2.data.list)
            resultData = resultData.sort(compare('noticeTime'))

            function compare(property) {
                return function(a, b) {
                    var value1 = a[property];
                    var value2 = b[property];
                    return value2 - value1;
                }
            }
            for (let i = 0; i < resultData.length; i++) {
                const item = resultData[i];
                for (let j = 0; j < ibox.length; j++) {
                    const ele = ibox[j];
                    if (ele.tokenId == item.tokenID) {
                        item.gName = ele.gName
                        item.gNum = ele.gNum
                        item.gId = ele.gId
                        break;
                    }
                }
                if (item.noticeName) {
                    html += `<li class="list-group-item d-flex">
                        <div class="item-wrap">
                            <p class="font-weight-bolder"><a target="_blank" href="https://www.ibox.art/zh-cn/notice/detail/?id=${item.id}">${item.noticeName}</a></p>
                            <div class="text-black-50">
                                <span class="label">时间: <span>${moment(item.noticeTime).format("YYYY-MM-DD HH:mm:ss")}</span></span>
                            </div>
                        </div>
                </li>`
                } else if (item.to === iid) {
                    // 买
                    html += `
                <li class="list-group-item d-flex">
                    <div class="item-wrap">
                        <p>${item.gName || '暂无数据'} <span class="bg-success badge badge-secondary">买入</span></p>
                        <div class="text-black-50">
                            <span class="label">时间: <span>${moment(item.noticeTime).format("YYYY-MM-DD HH:mm:ss")}</span></span>
                            <span class="label token">tokenId: ${item.tokenID}</span>
                            <span class="label number">编号: ${item.gNum || '--'}</span>
                            <span class="label number">gid: ${item.gId || '--'}</span>
                        </div>
                    </div>
                </li>
                `
                } else {
                    // 卖出
                    html +=
                        `<li class="list-group-item d-flex">
                    <div class="item-wrap">
                        <p>${item.gName || '暂无数据'} <span class="bg-danger badge badge-secondary">卖出</span></p>
                        <div class="text-black-50">
                            <span class="label">时间: <span>${moment(item.noticeTime).format("YYYY-MM-DD HH:mm:ss")}</span></span>
                            <span class="label token">tokenId: ${item.tokenID}</span>
                            <span class="label number">编号: ${item.gNum || '--'}</span>
                            <span class="label number">gid: ${item.gId || '--'}</span>
                        </div>
                    </div>
                </li>
                `
                }
            }

            let dom = document.getElementById('ul_wrap')
            dom.innerHTML = html
        }

        function getProductList(ids, cb) {
            $.ajax({
                type: "POST",
                url: "http://60.205.252.237:8080/Api/Token/verifyIbox",
                data: {
                    token: "kxmi29",
                    tokenIds: ids
                },
                success: function(msg) {
                    cb(msg)
                },
                error: () => {
                    $("#loading").addClass("hide");
                    $("#loading").removeClass("show");
                }
            });
        }

        function getList(cb) {
            $.ajax({
                type: "GET",
                url: "https://api-h5.ibox.art/nft-mall-web/v1.2/nft/product/getCommonNoticeList?page=1&pageSize=200",
                success: function(msg) {
                    cb(msg)
                },
                error: () => {

                }
            });
        }

        function showData(data) {
            console.info("Get Into showData");
            // json对象转成字符串
            var result = JSON.stringify(data);
            console.log('result: ', result);
        }
    </script>
</body>

</html>

</html>

</html>

</html>